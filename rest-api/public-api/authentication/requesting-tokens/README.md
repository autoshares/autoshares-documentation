---
description: Request the token that must be provided in all other API requests
---

# Requesting Tokens

### Introduction

In ETNA Trader, all API requests require a special authentication token to be provided in the header. Whether you want to create a price alert for a user, get a quote on a particular stock, or cancel an order â€” you first have to authorize the user with their unique token \(requests can only be made on behalf of some user\). This token can be generated by making a specific API call where you provide the user's username and their password. In response, you'll receive the above-mentioned token which can be used in all other requests.

Whenever you make such a request, a fresh token will be generated and returned to you. Thus, you can have multiple tokens for each user, and they will all be active until expiration.

{% hint style="info" %}
An authentication token's lifetime is 24 hours. 
{% endhint %}

### Overview

An authentication token for a particular user can be generated by making an API call to the the following URL:

```text
APIBaseURL + /token
```

The header of this request must contain the following three parameters:

**1. Et-App-Key**. This is the unique key of your app that identifies your app when communicating with our service. Contact your administrator to get this key.

**2.** **Username**. This is the username of the user on whose behalf all future requests will be made.

**3. Password**. This is the password of the user on whose behalf all future requests will be made.

### Response

In response to this API request, you'll receive a JSON file that contains the token. Here's an example of such response:

```javascript
{
    "State": "Succeeded",
    "Token": "FAKETokenAAKTQZR0F5K0OY5sfsWcd9rwAAAAACAAAAAAAQZgA/M8HtnoEJR0UxEDagAAAAAOgAAAAAIAACAAAACApaOit8LbBxTVxJXceMgzvN+"
}
```

where:

| Parameter | Description |
| :--- | :--- |
| State | This is the state of the request. Usually the value is set to Succeeded, meaning that the request has been successfully made. |
| Token | This is the token that must be provided in all subsequent API requests as the authentication bearer token.  |

### Two-factor authentication

If the user account has two-factor authentication enabled, there's also two other mandatory parameters that must be provided in the header:

* **VerificationCode** \(header\). This is the verification code that's sent by email or as an SMS message \(depending on the the user's settings\).
* **Token** \(header\). This is the authorization token that will be returned in response to the initial request.

These two parameter don't have to be provided in the initial request because the initial request because both authentication methods are performed in separate steps. In the first request, only username, password, and Et-App-Key must be provided. In response, you'll receive a JSON file with the **Step** parameter indicating the next authentication step:

```javascript
{
    'Step': 'VerificationCode', 
    'Reason': 'Expecting confirmation code', 
    'State': 'Expecting', 
    'Token': 'someToken+zrIbQGZl8sBT1LWQEY38SQ=='
}
```

Also notice that the response contains the **Token** parameter which must be used in the subsequent request as a header parameter in the following format:

* `"Authorization" : "Bearer + tokenFromTheRequest"`

In total, the header of the second request must contain five parameters:

1. **Username**;
2. **Password**;
3. **Et-App-Key**;
4. **Authorization** \(Bearer + token\);
5. **VerificationCode** \(the code received by email or SMS\).

In response to the second request, you'll receive the same JSON file that is sent in case there's no two-factor authentication enabled on the account:

```javascript
{
  "State": "Succeeded",
  "Token": "someToken"
}
```

The token parameter from the second request must be provided as the `Authorization` parameter in all future requests like placing orders, retrieving user's positions, etc. 

### Common Mistakes

Here are some of the common mistakes that developers make when requesting a token:

#### Failing to Specify the Et-App-Key Parameter

If you specify the wrong Et-App-Key parameter or fail to include it in the header altogether, you'll get the following error:

```javascript
{
    "error": "Application key is not defined or does not exist"
}
```

#### Incorrect or Missing User Credentials

If you specify the wrong user credentials or fail to include them in the request header, you'll get the following error:

```javascript
{
    "State": "Failed",
    "Step": "BaseAuthentication",
    "Reason": "Invalid credentials"
}
```

In the following article we outline in detail all of the required and optional header parameters, the range of response status codes, as well as a comprehensive list of all possible responses.

#### Failure to Provide the Authorization Token with Two-Factor Authentication

Another common mistake that developers make during authentication is failure to provide the authorization token that is retrieved during the first request of a two-factor authentication. If the token is not provided in the request header, the entire authentication process will be rendered corrupt:

```javascript
{'State': 'Failed', 'Step': 'VerificationCode', 'Reason': 'Corrupted ticket'}
```

### Sample Code

To see how initial authentication can be performed in code, feel free to examine our [sample requests](../../../code-samples.md) in a dedicated article.

